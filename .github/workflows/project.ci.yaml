name: CI Pipeline
on:
  push:
    branches:
      - main
jobs:
  arm_tests:
    uses: ./.github/workflows/run_tests.yaml
    with:
      platform: linux/arm64
      runner: ubuntu-24.04-arm
  x86_tests:
    uses: ./.github/workflows/run_tests.yaml
    with:
      platform: linux/amd64
      runner: ubuntu-latest
  arm_e2e:
    needs: arm_tests
    uses: ./.github/workflows/run_e2e_tests.yaml
    with:
      platform: linux/arm64
      runner: ubuntu-24.04-arm
  x86_e2e:
    needs: x86_tests
    uses: ./.github/workflows/run_e2e_tests.yaml
    with:
      platform: linux/amd64
      runner: ubuntu-latest
  federation_tests:
    uses: ./.github/workflows/run_federation_tests.yaml
  publish_images:
    uses: ./.github/workflows/release_docker_images.yaml
    needs: [arm_e2e, x86_e2e, federation_tests]
    permissions:
      contents: read
      packages: write
